<linkset>
  <html:link rel="localization" href="marginalia-preferences.ftl" />
</linkset>
<groupbox
  onload="Zotero.__addonInstance__.hooks.onPrefsEvent('load', { window })"
>
  <!-- API Configuration Section -->
  <html:fieldset>
    <html:legend>API Configuration</html:legend>
    <hbox align="center">
      <html:label for="marginalia-apiUrl" style="width: 120px;">API URL:</html:label>
      <html:input
        type="text"
        id="marginalia-apiUrl"
        preference="extensions.zotero.marginalia.apiUrl"
        style="flex: 1; min-width: 400px;"
        placeholder="https://api.openai.com/v1"
      />
    </hbox>
    <hbox align="center">
      <html:label for="marginalia-apiKey" style="width: 120px;">API Key:</html:label>
      <html:input
        type="password"
        id="marginalia-apiKey"
        preference="extensions.zotero.marginalia.apiKey"
        style="flex: 1; min-width: 400px;"
      />
    </hbox>
    <hbox align="center">
      <html:label for="marginalia-model" style="width: 120px;">Model:</html:label>
      <html:input
        type="text"
        id="marginalia-model"
        preference="extensions.zotero.marginalia.model"
        style="flex: 1; min-width: 400px;"
        placeholder="gpt-4o-mini"
      />
    </hbox>
    <hbox>
      <button id="marginalia-test-connection" label="Test Connection" />
      <button id="marginalia-save-settings" label="Save" />
    </hbox>
  </html:fieldset>

  <!-- Chat Settings Section -->
  <html:fieldset>
    <html:legend>Chat Settings</html:legend>
    <hbox align="center">
      <html:label for="marginalia-maxHistoryRounds" style="width: 130px;">Max History Rounds:</html:label>
      <html:input
        type="number"
        id="marginalia-maxHistoryRounds"
        preference="extensions.zotero.marginalia.maxHistoryRounds"
        min="1"
        max="100"
        value="20"
        style="width: 60px;"
      />
    </hbox>
    <hbox align="start">
      <html:label for="marginalia-systemPrompt" style="width: 120px; margin-top: 8px;">System Prompt:</html:label>
      <html:textarea
        id="marginalia-systemPrompt"
        preference="extensions.zotero.marginalia.systemPrompt"
        style="flex: 1; height: 100px; padding: 8px; border: 1px solid #D1D1D6; border-radius: 4px; font-family: monospace; font-size: 12px;"
        placeholder="You are a helpful academic paper analysis assistant."
      ></html:textarea>
    </hbox>
  </html:fieldset>
</groupbox>
<vbox>
  <html:label
    data-l10n-id="pref-help"
    data-l10n-args='{"time": "__buildTime__","name": "__addonName__","version":"__buildVersion__"}'
  ></html:label>
</vbox>
